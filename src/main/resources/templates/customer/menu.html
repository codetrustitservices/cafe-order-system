<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Menu - Order Now</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">


</head>
<body>
<!-- Modern Navbar -->
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/">‚òï My Cafe</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link active" href="/menu">Menu</a>
                <a class="nav-link" href="/">Admin</a>
            </div>
        </div>
    </div>
</nav>

<!-- Clean Header -->
<div class="page-header">
    <div class="container">
        <h2>Our Menu</h2>
        <p>Fresh ingredients, bold flavors</p>
    </div>
</div>

<div class="container mt-5">
    <div class="row">
        <!-- Menu Items -->
        <div class="col-lg-8">
            <!-- Coffee -->
            <div class="category-section">
                <div class="category-header">
                    <span class="category-icon">‚òï</span>
                    <h3>Coffee</h3>
                </div>
                <div class="row g-4">
                    <div class="col-md-6" th:each="item : ${menuItems}" th:if="${item.category == 'Coffee'}">
                        <div class="menu-card">
                            <div class="menu-card-img-wrapper">
                                <img th:src="${item.imageUrl}" class="menu-card-img" alt="Coffee">
                            </div>
                            <div class="menu-card-body">
                                <h5 class="menu-card-title" th:text="${item.name}">Cappuccino</h5>
                                <p class="menu-card-description" th:text="${item.description}">Rich creamy coffee</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Çπ<span th:text="${item.price}">120</span></span>
                                    <button class="btn-add-cart"
                                            th:data-id="${item.id}"
                                            th:data-name="${item.name}"
                                            th:data-price="${item.price}"
                                            onclick="addToCart(this)">
                                        Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Snacks -->
            <div class="category-section">
                <div class="category-header">
                    <span class="category-icon">ü•ê</span>
                    <h3>Snacks</h3>
                </div>
                <div class="row g-4">
                    <div class="col-md-6" th:each="item : ${menuItems}" th:if="${item.category == 'Snacks'}">
                        <div class="menu-card">
                            <div class="menu-card-img-wrapper">
                                <img th:src="${item.imageUrl}" class="menu-card-img" alt="Snack">
                            </div>
                            <div class="menu-card-body">
                                <h5 class="menu-card-title" th:text="${item.name}">Croissant</h5>
                                <p class="menu-card-description" th:text="${item.description}">Buttery pastry</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Çπ<span th:text="${item.price}">80</span></span>
                                    <button class="btn-add-cart"
                                            th:data-id="${item.id}"
                                            th:data-name="${item.name}"
                                            th:data-price="${item.price}"
                                            onclick="addToCart(this)">
                                        Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meals -->
            <div class="category-section">
                <div class="category-header">
                    <span class="category-icon">üçΩÔ∏è</span>
                    <h3>Meals</h3>
                </div>
                <div class="row g-4">
                    <div class="col-md-6" th:each="item : ${menuItems}" th:if="${item.category == 'Meals'}">
                        <div class="menu-card">
                            <div class="menu-card-img-wrapper">
                                <img th:src="${item.imageUrl}" class="menu-card-img" alt="Meal">
                            </div>
                            <div class="menu-card-body">
                                <h5 class="menu-card-title" th:text="${item.name}">Burger</h5>
                                <p class="menu-card-description" th:text="${item.description}">Handcrafted</p>
                                <div class="menu-card-footer">
                                    <span class="menu-card-price">‚Çπ<span th:text="${item.price}">200</span></span>
                                    <button class="btn-add-cart"
                                            th:data-id="${item.id}"
                                            th:data-name="${item.name}"
                                            th:data-price="${item.price}"
                                            onclick="addToCart(this)">
                                        Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Cart -->
        <div class="col-lg-4 d-none d-lg-block">
            <div class="cart-sidebar">
                <div class="cart-header">
                    <h5>Your Order</h5>
                    <span class="cart-badge" id="desktop-cart-count">0</span>
                </div>
                <div id="desktop-cart-items">
                    <div class="empty-cart">Cart is empty</div>
                </div>
                <div class="cart-total">
                    <p>Total: ‚Çπ<span id="desktop-cart-total">0</span></p>
                </div>
                <div class="d-grid gap-2">
                    <button class="btn-checkout" onclick="checkout()" id="desktop-checkout-btn" disabled>
                        Order via WhatsApp
                    </button>
                    <button class="btn-clear" onclick="clearCart()">Clear</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Floating Cart -->
<div class="floating-cart-btn">
    <button onclick="openCartModal()">
        üõí
        <span class="cart-count-badge" id="mobile-cart-count">0</span>
    </button>
</div>

<!-- Mobile Cart Modal -->
<div class="cart-modal" id="cartModal" onclick="closeCartModal(event)">
    <div class="cart-modal-content" onclick="event.stopPropagation()">
        <div class="cart-modal-header">
            <h5>Your Order</h5>
            <button class="close-modal" onclick="closeCartModal()">√ó</button>
        </div>
        <div id="mobile-cart-items">
            <div class="empty-cart">Cart is empty</div>
        </div>
        <div class="cart-total">
            <p>Total: ‚Çπ<span id="mobile-cart-total">0</span></p>
        </div>
        <div class="d-grid gap-2">
            <button class="btn-checkout" onclick="checkout()" id="mobile-checkout-btn" disabled>
                Order via WhatsApp
            </button>
            <button class="btn-clear" onclick="clearCart(); closeCartModal();">Clear</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let cart = [];

    function addToCart(button) {
        const id = button.getAttribute('data-id');
        const name = button.getAttribute('data-name');
        const price = parseFloat(button.getAttribute('data-price'));

        const existing = cart.find(item => item.id === id);
        if (existing) {
            existing.quantity++;
        } else {
            cart.push({id, name, price, quantity: 1});
        }

        button.innerHTML = '‚úì';
        setTimeout(() => {
            button.innerHTML = 'Add';
        }, 600);

        updateCart();
    }

    function updateCart() {
        let cartHTML = '';
        let total = 0;

        if (cart.length === 0) {
            cartHTML = '<div class="empty-cart">Cart is empty</div>';
            document.getElementById('desktop-checkout-btn').disabled = true;
            document.getElementById('mobile-checkout-btn').disabled = true;
        } else {
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                cartHTML += `
                    <div class="cart-item">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div style="flex: 1;">
                                <strong>${item.name}</strong><br>
                                <span style="font-size: 0.85rem; color: var(--text-light);">Qty: ${item.quantity}</span>
                            </div>
                            <strong>‚Çπ${itemTotal}</strong>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn-qty" onclick="decreaseQty(${index})">‚àí</button>
                            <button class="btn-qty" onclick="increaseQty(${index})">+</button>
                            <button class="btn-remove" onclick="removeItem(${index})">√ó</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('desktop-checkout-btn').disabled = false;
            document.getElementById('mobile-checkout-btn').disabled = false;
        }

        document.getElementById('desktop-cart-items').innerHTML = cartHTML;
        document.getElementById('mobile-cart-items').innerHTML = cartHTML;
        document.getElementById('desktop-cart-total').innerText = total;
        document.getElementById('mobile-cart-total').innerText = total;
        document.getElementById('desktop-cart-count').innerText = cart.length;
        document.getElementById('mobile-cart-count').innerText = cart.length;
    }

    function increaseQty(index) {
        cart[index].quantity++;
        updateCart();
    }

    function decreaseQty(index) {
        if (cart[index].quantity > 1) {
            cart[index].quantity--;
        } else {
            cart.splice(index, 1);
        }
        updateCart();
    }

    function removeItem(index) {
        cart.splice(index, 1);
        updateCart();
    }

    function clearCart() {
        cart = [];
        updateCart();
    }

    function checkout() {
        if (cart.length === 0) return;

        let message = "*New Order*\n\n";
        let total = 0;

        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            message += `${item.name} x${item.quantity} = ‚Çπ${itemTotal}\n`;
        });

        message += `\n*Total: ‚Çπ${total}*`;

        const whatsappNumber = '918149328485';
        window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`, '_blank');
        closeCartModal();
    }

    function openCartModal() {
        document.getElementById('cartModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function closeCartModal(event) {
        if (!event || event.target.id === 'cartModal') {
            document.getElementById('cartModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    updateCart();
</script>
</body>
</html>